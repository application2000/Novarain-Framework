jQuery(function(l){var r="?option=com_ajax&format=raw&plugin=nrframework&task=ConditionBuilder";function d(e,t,o){l.ajax({url:system_url+r+"&subtask="+e,data:t,success:function(e){o(e),l(".cb").find("select").chosen({disable_search_threshold:10}).end().find(".hasPopover").popover({html:!0,trigger:"hover focus",container:"body"})},error:function(e,t,o){alert(o)}})}system_url=l(".cb").attr("data-root"),l(document).on("click",".addCondition",function(e){e.preventDefault();var t,o,r,n,a,c,s=l(".cb");$element=l(e.target).closest(".cb-item"),$controlGroup=$element.closest(".cb-group"),$controlGroup.length?(groupKey=parseInt($controlGroup.attr("data-key")),conditionKey=parseInt($controlGroup.attr("data-max-index"))+1):(groupKey=parseInt(s.attr("data-max-index"))+1,conditionKey=0),t=$element,o=s.data("control-group"),r=groupKey,n=conditionKey,a=0==t.closest(".cb-group").length,d("add",c={controlgroup:o,groupKey:r,conditionKey:n,conditionsList:l(".cb").attr("data-conditionslist")},function(e){a?(l("<div/>").addClass("cb-group").attr("data-key",c.groupKey).attr("data-max-index",0).appendTo(".cb-items").html(e),l(".cb").attr("data-max-index",c.groupKey)):(t.after(e),t.closest(".cb-group").attr("data-max-index",n))})}),l(document).on("click",".removeCondition",function(e){e.preventDefault(),function(e){if(1==l(".cb-item").length)return alert("You can't remove the last item");$group=e.closest(".cb-group"),e.remove(),0==$group.children().length&&$group.remove()}(l(e.target).closest(".cb-item"))}),l(document).on("change",".condition_selector",function(e){e.preventDefault();var t,o,r,n=l(e.target).closest(".cb-item");condition_name=l(this).val(),t=n,o=condition_name,r=t.closest(".cb"),groupKey=parseInt(t.closest(".cb-group").attr("data-key")),conditionKey=parseInt(t.closest(".cb-item").attr("data-key")),options={controlgroup:r.attr("data-control-group")+"["+groupKey+"]["+conditionKey+"]",name:o},d("options",options,function(e){t.find(".cb-item-content").html(e),l(document).trigger("afterConditionSettings",[t,o])})}),l(document).on("afterConditionSettings",function(e,t,o){!function(e,t){switch(e){case"usergroup":case"menu":case"category":case"k2category":NRHelper.loadStyleSheet(system_url+"/media/plg_system_nrframework/css/treeselect.css"),NRHelper.loadScript(system_url+"/media/plg_system_nrframework/js/treeselect.js",function(){NRTreeselect.init(t.get(0))});break;case"date":NRHelper.loadStyleSheet(system_url+"/media/system/css/fields/calendar.css"),NRHelper.loadScript(system_url+"/media/system/js/fields/calendar-locales/en.js"),NRHelper.loadScript(system_url+"/media/system/js/fields/calendar-locales/date/gregorian/date-helper.min.js"),NRHelper.loadScript(system_url+"/media/system/js/fields/calendar.min.js",function(){var e=t.get(0).querySelectorAll(".field-calendar");for(i=0;i<e.length;i++)JoomlaCalendar.init(e[i])});break;case"time":NRHelper.loadStyleSheet(system_url+"/media/plg_system_nrframework/css/jquery-clockpicker.min.css"),NRHelper.loadScript(system_url+"/media/plg_system_nrframework/js/jquery-clockpicker.min.js",function(){t.find(".clockpicker").clockpicker()})}"date"!=e&&l(document).trigger("subform-row-add")}(o,t)})});